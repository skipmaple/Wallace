# Wallace v4ï¼šæ‹ŸäººåŒ–æ¡Œé¢ AI æœºå™¨äºº

> **ç›®æ ‡**ï¼šæ„å»ºä¸€ä¸ªå…·å¤‡"å¬ã€è¯´ã€çœ‹ã€æ„ŸçŸ¥ã€æƒ…æ„Ÿ"èƒ½åŠ›çš„æ¡Œé¢è¯­éŸ³åŠ©æ‰‹ï¼Œè®© AI çœŸæ­£"æ´»"èµ·æ¥ã€‚  
> **æ¶æ„**ï¼šESP32-S3ï¼ˆN16R8ï¼‰å•èŠ¯ç‰‡å…¨æ ˆæ–¹æ¡ˆ + PC æœåŠ¡ç«¯ååŒå¤„ç†ã€‚  
> **ç‰ˆæœ¬æ›´æ–°**ï¼šv4 æ–°å¢æƒ…ç»ªç³»ç»Ÿã€çœ¼ç¥è¿½è¸ªã€ç¯å¢ƒæ„ŸçŸ¥ã€æ™ºèƒ½å®¶å±…è”åŠ¨ã€è¶£å‘³ç©æ³•ç­‰æ‰©å±•åŠŸèƒ½ã€‚

---

## ç›®å½•

- [1. é¡¹ç›®æ¦‚è¿°](#1-é¡¹ç›®æ¦‚è¿°)
- [2. ç³»ç»Ÿæ¶æ„](#2-ç³»ç»Ÿæ¶æ„)
  - [2.1 ç¡¬ä»¶é“¾è·¯](#21-ç¡¬ä»¶é“¾è·¯)
  - [2.2 æ•°æ®æµå‘ï¼ˆè¯­éŸ³å”¤é†’æ¨¡å¼ï¼‰](#22-æ•°æ®æµå‘è¯­éŸ³å”¤é†’æ¨¡å¼)
- [3. ç¡¬ä»¶è®¾è®¡ä¸å¼•è„šè§„åˆ’](#3-ç¡¬ä»¶è®¾è®¡ä¸å¼•è„šè§„åˆ’)
  - [3.1 æ ¸å¿ƒæ¨¡å—å¼•è„š](#31-æ ¸å¿ƒæ¨¡å—å¼•è„š)
  - [3.2 æ‰©å±•æ¨¡å—å¼•è„š](#32-æ‰©å±•æ¨¡å—å¼•è„š)
- [4. è½¯ä»¶å®ç°è·¯çº¿](#4-è½¯ä»¶å®ç°è·¯çº¿)
  - [4.1 å›ºä»¶ç«¯ï¼ˆESP32-S3ï¼‰](#41-å›ºä»¶ç«¯esp32-s3)
  - [4.2 è¯­éŸ³å”¤é†’æ–¹æ¡ˆ](#42-è¯­éŸ³å”¤é†’æ–¹æ¡ˆ)
  - [4.3 æœåŠ¡ç«¯ï¼ˆPCï¼‰](#43-æœåŠ¡ç«¯pc)
- [5. æ‹ŸäººåŒ–ä½“éªŒè®¾è®¡](#5-æ‹ŸäººåŒ–ä½“éªŒè®¾è®¡)
  - [5.1 æƒ…ç»ªç³»ç»Ÿ](#51-æƒ…ç»ªç³»ç»Ÿ)
  - [5.2 çœ¼ç¥è¿½è¸ª](#52-çœ¼ç¥è¿½è¸ª)
  - [5.3 é—²ç½®åŠ¨ç”»](#53-é—²ç½®åŠ¨ç”»)
  - [5.4 å‘¼å¸ç¯æ•ˆæœ](#54-å‘¼å¸ç¯æ•ˆæœ)
- [6. AI èƒ½åŠ›æ‰©å±•](#6-ai-èƒ½åŠ›æ‰©å±•)
  - [6.1 è®°å¿†ç³»ç»Ÿ](#61-è®°å¿†ç³»ç»Ÿ)
  - [6.2 ä¸»åŠ¨å…³æ€€](#62-ä¸»åŠ¨å…³æ€€)
  - [6.3 å¤šæ¨¡æ€è¾“å…¥](#63-å¤šæ¨¡æ€è¾“å…¥)
  - [6.4 æœ¬åœ°æŒ‡ä»¤è¯†åˆ«](#64-æœ¬åœ°æŒ‡ä»¤è¯†åˆ«)
- [7. ç¯å¢ƒæ„ŸçŸ¥ä¸æ™ºèƒ½å®¶å±…](#7-ç¯å¢ƒæ„ŸçŸ¥ä¸æ™ºèƒ½å®¶å±…)
  - [7.1 ç¯å¢ƒä¼ æ„Ÿå™¨](#71-ç¯å¢ƒä¼ æ„Ÿå™¨)
  - [7.2 æ™ºèƒ½å®¶å±…è”åŠ¨](#72-æ™ºèƒ½å®¶å±…è”åŠ¨)
- [8. è¶£å‘³ç©æ³•](#8-è¶£å‘³ç©æ³•)
  - [8.1 å°æ¸¸æˆæ¨¡å¼](#81-å°æ¸¸æˆæ¨¡å¼)
  - [8.2 æ¡Œé¢å® ç‰©æ¨¡å¼](#82-æ¡Œé¢å® ç‰©æ¨¡å¼)
  - [8.3 å®ç”¨å·¥å…·](#83-å®ç”¨å·¥å…·)
  - [8.4 å½©è›‹åŠŸèƒ½](#84-å½©è›‹åŠŸèƒ½)
- [9. ç”µæºç®¡ç†ç­–ç•¥](#9-ç”µæºç®¡ç†ç­–ç•¥)
  - [9.1 ä¾›ç”µæ¶æ„](#91-ä¾›ç”µæ¶æ„)
  - [9.2 åŠŸè€—é¢„ä¼°ä¸ç»­èˆª](#92-åŠŸè€—é¢„ä¼°ä¸ç»­èˆª)
  - [9.3 ä½åŠŸè€—ä¼˜åŒ–ç­–ç•¥](#93-ä½åŠŸè€—ä¼˜åŒ–ç­–ç•¥)
- [10. ç¡¬ä»¶é‡‡è´­æ¸…å•ï¼ˆBOMï¼‰](#10-ç¡¬ä»¶é‡‡è´­æ¸…å•bom)
  - [10.1 æ ¸å¿ƒæ¨¡å—ï¼ˆå¿…é€‰ï¼‰](#101-æ ¸å¿ƒæ¨¡å—å¿…é€‰)
  - [10.2 æ‰©å±•æ¨¡å—ï¼ˆå¯é€‰ï¼‰](#102-æ‰©å±•æ¨¡å—å¯é€‰)
  - [10.3 é‡‡è´­æ³¨æ„äº‹é¡¹](#103-é‡‡è´­æ³¨æ„äº‹é¡¹)
- [11. å·²çŸ¥é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ](#11-å·²çŸ¥é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ)
- [12. ç¡¬ä»¶å½¢æ€åˆ›æ„](#12-ç¡¬ä»¶å½¢æ€åˆ›æ„)
- [13. å¼€å‘è·¯çº¿å›¾](#13-å¼€å‘è·¯çº¿å›¾)
- [é™„å½• Aï¼šå¸‚åœºæ–¹æ¡ˆå¯¹æ¯”å‚è€ƒ](#é™„å½•-aå¸‚åœºæ–¹æ¡ˆå¯¹æ¯”å‚è€ƒ)
- [é™„å½• Bï¼šå¼€å‘è°ƒè¯•å»ºè®®](#é™„å½•-bå¼€å‘è°ƒè¯•å»ºè®®)

---

## 1. é¡¹ç›®æ¦‚è¿°

### æ ¸å¿ƒä½“éªŒ

| èƒ½åŠ› | æè¿° | å®ç°æ–¹å¼ |
|------|------|----------|
| **å¬** | è¯­éŸ³å”¤é†’ + è¯­éŸ³é‡‡é›† | ESP32-S3 æœ¬åœ°è¿è¡Œå”¤é†’è¯æ¨¡å‹ï¼ŒæŒç»­ç›‘å¬ |
| **è¯´** | è‡ªç„¶è¯­éŸ³å›å¤ | PC ç«¯ LLM ç”Ÿæˆæ–‡æœ¬ï¼ŒTTS åˆæˆè¯­éŸ³å›ä¼ æ’­æ”¾ |
| **çœ‹** | åœ†å½¢å±å¹•æ¨¡æ‹Ÿçœ¼ç› | çœ¨çœ¼ã€æ³¨è§†ã€æƒ…ç»ªè¡¨æƒ…ç­‰æ‹ŸäººåŒ–åŠ¨æ•ˆ |
| **æ„ŸçŸ¥** | ç¯å¢ƒä¸ç”¨æˆ·æ„ŸçŸ¥ | æ¸©æ¹¿åº¦ã€å…‰çº¿ã€è·ç¦»ã€äººè„¸æ£€æµ‹ï¼ˆå¯é€‰ï¼‰ |
| **æƒ…æ„Ÿ** | æƒ…ç»ªçŠ¶æ€ç³»ç»Ÿ | æ ¹æ®å¯¹è¯å†…å®¹å±•ç¤ºå–œæ€’å“€ä¹ç­‰æƒ…ç»ª |
| **ç»­èˆª** | ç”µæ± ä¾›ç”µï¼Œè¯­éŸ³å”¤é†’å¾…æœº | é¢„è®¡ 3-5 å¤©å¾…æœºï¼ˆ2500mAh ç”µæ± ï¼‰ |

### v4 ç‰ˆæœ¬æ–°å¢ç‰¹æ€§

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  v4 æ–°å¢ç‰¹æ€§                                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ­ æ‹ŸäººåŒ–å‡çº§                                                  â”‚
â”‚     â”œâ”€â”€ æƒ…ç»ªç³»ç»Ÿï¼ˆå–œæ€’å“€ä¹è¡¨æƒ…ï¼‰                                â”‚
â”‚     â”œâ”€â”€ çœ¼ç¥è¿½è¸ªï¼ˆè·Ÿéšç”¨æˆ·æ–¹ä½ï¼‰                                â”‚
â”‚     â”œâ”€â”€ é—²ç½®åŠ¨ç”»ï¼ˆè‡ªä¸»è¡Œä¸ºï¼‰                                    â”‚
â”‚     â””â”€â”€ RGB å‘¼å¸ç¯çŠ¶æ€åé¦ˆ                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ§  AI èƒ½åŠ›æ‰©å±•                                                 â”‚
â”‚     â”œâ”€â”€ è®°å¿†ç³»ç»Ÿï¼ˆè®°ä½ç”¨æˆ·åå¥½ï¼‰                                â”‚
â”‚     â”œâ”€â”€ ä¸»åŠ¨å…³æ€€ï¼ˆå®šæ—¶æé†’ã€å¤©æ°”é¢„è­¦ï¼‰                          â”‚
â”‚     â”œâ”€â”€ å¤šæ¨¡æ€è¾“å…¥ï¼ˆå¯é€‰æ‘„åƒå¤´ï¼‰                                â”‚
â”‚     â””â”€â”€ æœ¬åœ°æŒ‡ä»¤è¯†åˆ«ï¼ˆç®€å•å‘½ä»¤æ— éœ€è”ç½‘ï¼‰                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ  ç¯å¢ƒæ„ŸçŸ¥ä¸æ™ºèƒ½å®¶å±…                                          â”‚
â”‚     â”œâ”€â”€ æ¸©æ¹¿åº¦/å…‰çº¿/ç©ºæ°”è´¨é‡ä¼ æ„Ÿå™¨                              â”‚
â”‚     â””â”€â”€ MQTT/HTTP æ™ºèƒ½å®¶å±…æ§åˆ¶                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ® è¶£å‘³ç©æ³•                                                    â”‚
â”‚     â”œâ”€â”€ å°æ¸¸æˆï¼ˆçŒœæ•°å­—ã€æˆè¯­æ¥é¾™ï¼‰                              â”‚
â”‚     â”œâ”€â”€ æ¡Œé¢å® ç‰©æ¨¡å¼                                            â”‚
â”‚     â””â”€â”€ éšè—å½©è›‹                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. ç³»ç»Ÿæ¶æ„

### 2.1 ç¡¬ä»¶é“¾è·¯

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ESP32-S3 N16R8                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚ WakeNet   â”‚ â”‚ Audio     â”‚ â”‚ Display   â”‚ â”‚ Sensors   â”‚           â”‚
â”‚  â”‚ å”¤é†’æ£€æµ‹  â”‚ â”‚ I2S éŸ³é¢‘  â”‚ â”‚ SPI å±å¹•  â”‚ â”‚ I2C ä¼ æ„Ÿ  â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚             â”‚             â”‚             â”‚
   â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”
   â”‚ INMP441   â”‚ â”‚ MAX98357A â”‚ â”‚ GC9A01    â”‚ â”‚ VL53L0X   â”‚
   â”‚ éº¦å…‹é£    â”‚ â”‚ åŠŸæ”¾      â”‚ â”‚ åœ†å½¢å±    â”‚ â”‚ æµ‹è·      â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚                       
                 â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚ è…”ä½“å–‡å­  â”‚               â”‚ WS2812B   â”‚
                 â”‚ 4Î© 3W    â”‚               â”‚ RGB ç¯å¸¦  â”‚
                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ç”µæºç³»ç»Ÿ                                     â”‚
â”‚  18650 ç”µæ±  â”€â”€â–¶ TP4056 å……ç”µ â”€â”€â–¶ MT3608 å‡å‹ 5V â”€â”€â–¶ å„æ¨¡å—ä¾›ç”µ       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      å¯é€‰æ‰©å±•æ¨¡å—                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚ OV2640    â”‚ â”‚ DHT22     â”‚ â”‚ BH1750    â”‚ â”‚ MPU6050   â”‚           â”‚
â”‚  â”‚ æ‘„åƒå¤´    â”‚ â”‚ æ¸©æ¹¿åº¦    â”‚ â”‚ å…‰çº¿      â”‚ â”‚ å§¿æ€      â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 æ•°æ®æµå‘ï¼ˆè¯­éŸ³å”¤é†’æ¨¡å¼ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ã€å¾…æœºç›‘å¬çŠ¶æ€ã€‘åŠŸè€— ~25mA                                          â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚  â”‚ INMP441  â”‚â”€â”€â”€â–¶â”‚ WakeNet  â”‚    â”‚ é—²ç½®åŠ¨ç”» â”‚  çœ¼ç›éšæœºçœ‹çœ‹å››å‘¨    â”‚
â”‚  â”‚ éº¦å…‹é£   â”‚    â”‚ å”¤é†’æ£€æµ‹ â”‚    â”‚ å±å¹•æ˜¾ç¤º â”‚  å¶å°”çœ¨çœ¼ã€æ‰“å“ˆæ¬     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â”‚                       â”‚                                             â”‚
â”‚                       â”‚ æ£€æµ‹åˆ°å”¤é†’è¯ "Hi Wallace"                   â”‚
â”‚                       â–¼                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ã€å”¤é†’çŠ¶æ€ã€‘                                                        â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  1. RGB ç¯å¸¦äº®èµ·æ¸å˜å…‰ç¯                                      â”‚  â”‚
â”‚  â”‚  2. å±å¹•æ˜¾ç¤º"è†å¬"è¡¨æƒ…ï¼ˆçœ¼ç›çå¤§ã€ç³å­”æ”¾å¤§ï¼‰                  â”‚  â”‚
â”‚  â”‚  3. WiFi å¿«é€Ÿè¿æ¥ PC æœåŠ¡ç«¯                                   â”‚  â”‚
â”‚  â”‚  4. CPU æå‡è‡³ 240MHz                                         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                       â”‚                                             â”‚
â”‚                       â–¼                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ã€å½•éŸ³ä¸Šä¼ ã€‘                                                        â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚ éº¦å…‹é£   â”‚ â”€â”€I2Sâ”€â”€â–¶â”‚ éŸ³é¢‘ç¼“å­˜ â”‚ â”€â”€WSâ”€â”€â”€â–¶â”‚ PCæœåŠ¡ç«¯ â”‚           â”‚
â”‚  â”‚ é‡‡é›†     â”‚         â”‚ Opuså‹ç¼© â”‚         â”‚ æ¥æ”¶     â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                                     â”‚
â”‚  å±å¹•æ˜¾ç¤ºï¼šçœ¼ç›ä¸“æ³¨çœ‹ç€ç”¨æˆ·ï¼ŒRGB ç¯å¸¦å‘¼å¸é—ªçƒ                        â”‚
â”‚                       â”‚                                             â”‚
â”‚                       â–¼                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ã€PC ç«¯å¤„ç†ã€‘                                                       â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ VAD    â”‚â”€â”€â–¶â”‚ ASR    â”‚â”€â”€â–¶â”‚ è®°å¿†   â”‚â”€â”€â–¶â”‚ LLM    â”‚â”€â”€â–¶â”‚ TTS    â”‚  â”‚
â”‚  â”‚ é™éŸ³æ£€æµ‹â”‚   â”‚ è¯­éŸ³è¯†åˆ«â”‚   â”‚ æ³¨å…¥   â”‚   â”‚ ç”Ÿæˆå›å¤â”‚   â”‚ è¯­éŸ³åˆæˆâ”‚  â”‚
â”‚  â”‚Silero  â”‚   â”‚Whisper â”‚   â”‚ Contextâ”‚   â”‚DeepSeekâ”‚   â”‚Edge-TTSâ”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                             â”‚                      â”‚
â”‚                              æå–æƒ…ç»ªæ ‡ç­¾ [mood:happy]              â”‚
â”‚                       â”‚                                             â”‚
â”‚                       â–¼                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ã€å›å¤æ’­æ”¾ã€‘                                                        â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚ PCæ¨é€   â”‚ â”€â”€WSâ”€â”€â”€â–¶â”‚ ESP32    â”‚ â”€â”€I2Sâ”€â”€â–¶â”‚ å–‡å­æ’­æ”¾ â”‚           â”‚
â”‚  â”‚ éŸ³é¢‘æµ   â”‚         â”‚ ç¼“å­˜è§£ç  â”‚         â”‚          â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                                     â”‚
â”‚  å±å¹•æ˜¾ç¤ºï¼šæ ¹æ®æƒ…ç»ªæ ‡ç­¾åˆ‡æ¢è¡¨æƒ… + è¯´è¯æ—¶å˜´å·´/æ³¢å½¢å¾‹åŠ¨                â”‚
â”‚  RGB ç¯å¸¦ï¼šéšéŸ³é¢‘æŒ¯å¹…å¾‹åŠ¨                                           â”‚
â”‚                       â”‚                                             â”‚
â”‚                       â–¼                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ã€è¿”å›å¾…æœºã€‘                                                        â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  1. æ–­å¼€ WiFiï¼ŒCPU é™é¢‘è‡³ 80MHz                               â”‚  â”‚
â”‚  â”‚  2. å±å¹•åˆ‡æ¢å›é—²ç½®åŠ¨ç”»                                        â”‚  â”‚
â”‚  â”‚  3. RGB ç¯å¸¦æ¢å¤æ·¡è“è‰²å‘¼å¸                                    â”‚  â”‚
â”‚  â”‚  4. ç»§ç»­ç›‘å¬å”¤é†’è¯                                            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. ç¡¬ä»¶è®¾è®¡ä¸å¼•è„šè§„åˆ’

### 3.1 æ ¸å¿ƒæ¨¡å—å¼•è„š

#### éŸ³é¢‘è¾“å…¥ï¼ˆINMP441 - I2S_NUM_0ï¼‰

| INMP441 å¼•è„š | ESP32-S3 GPIO | è¯´æ˜ |
|-------------|---------------|------|
| SCK (BCLK)  | GPIO 41       | I2S ä½æ—¶é’Ÿ |
| WS (LRC)    | GPIO 42       | I2S å­—é€‰æ‹© |
| SD (DOUT)   | GPIO 2        | I2S æ•°æ®è¾“å‡º |
| VDD         | 3.3V          | ä¾›ç”µ |
| GND         | GND           | æ¥åœ° |
| L/R         | GND           | æ¥åœ° = å·¦å£°é“ |

#### éŸ³é¢‘è¾“å‡ºï¼ˆMAX98357A - I2S_NUM_1ï¼‰

| MAX98357A å¼•è„š | ESP32-S3 GPIO | è¯´æ˜ |
|---------------|---------------|------|
| BCLK          | GPIO 15       | I2S ä½æ—¶é’Ÿ |
| LRC           | GPIO 16       | I2S å­—é€‰æ‹© |
| DIN           | GPIO 17       | I2S æ•°æ®è¾“å…¥ |
| Vin           | **5V**        | ä¾›ç”µ |
| GND           | GND           | æ¥åœ° |

#### è§†è§‰æ˜¾ç¤ºï¼ˆGC9A01 - SPIï¼‰

| GC9A01 å¼•è„š | ESP32-S3 GPIO | è¯´æ˜ |
|------------|---------------|------|
| SCL (SCK)  | GPIO 12       | SPI æ—¶é’Ÿ |
| SDA (MOSI) | GPIO 11       | SPI æ•°æ® |
| RES (RST)  | GPIO 10       | å¤ä½ |
| DC         | GPIO 9        | æ•°æ®/å‘½ä»¤ |
| CS         | GPIO 46       | ç‰‡é€‰ |
| BLK        | GPIO 45       | èƒŒå…‰ PWM |
| VCC/GND    | 3.3V / GND    | ä¾›ç”µ |

#### RGB ç¯å¸¦ï¼ˆWS2812Bï¼‰

| WS2812B | ESP32-S3 GPIO | è¯´æ˜ |
|---------|---------------|------|
| DIN     | GPIO 48       | æ•°æ®è¾“å…¥ï¼ˆæ”¯æŒ RMTï¼‰ |
| VCC     | 5V            | ä¾›ç”µ |
| GND     | GND           | æ¥åœ° |

### 3.2 æ‰©å±•æ¨¡å—å¼•è„š

#### I2C æ€»çº¿ï¼ˆä¼ æ„Ÿå™¨å…±ç”¨ï¼‰

| åŠŸèƒ½ | ESP32-S3 GPIO |
|------|---------------|
| SDA  | GPIO 6        |
| SCL  | GPIO 7        |

#### æ‰©å±•æ¨¡å—åœ°å€

| æ¨¡å— | I2C åœ°å€ | åŠŸèƒ½ |
|------|---------|------|
| VL53L0X | 0x29 | æ¿€å…‰æµ‹è·ï¼ˆçœ¼ç¥è¿½è¸ªï¼‰ |
| BH1750 | 0x23 | å…‰çº¿æ„Ÿåº” |
| DHT22 | GPIO 4ï¼ˆå•æ€»çº¿ï¼‰ | æ¸©æ¹¿åº¦ |
| MPU6050 | 0x68 | å§¿æ€æ£€æµ‹ï¼ˆæ‘‡ä¸€æ‘‡ï¼‰ |

#### æ‘„åƒå¤´ï¼ˆOV2640ï¼Œå¯é€‰ï¼‰

| OV2640 å¼•è„š | ESP32-S3 GPIO |
|------------|---------------|
| SIOD (SDA) | GPIO 6        |
| SIOC (SCL) | GPIO 7        |
| VSYNC      | GPIO 38       |
| HREF       | GPIO 39       |
| PCLK       | GPIO 40       |
| D0-D7      | GPIO 18-21, 36-37, 47, 3 |
| XCLK       | GPIO 8        |

#### å…¶ä»–

| æ¨¡å— | ESP32-S3 GPIO | è¯´æ˜ |
|------|---------------|------|
| TTP223 è§¦æ‘¸ | GPIO 1 (RTC) | å¤‡ç”¨æ‰‹åŠ¨å”¤é†’ |
| ç‰©ç†æŒ‰é’® | GPIO 0 | å½©è›‹è§¦å‘ |

---

## 4. è½¯ä»¶å®ç°è·¯çº¿

### 4.1 å›ºä»¶ç«¯ï¼ˆESP32-S3ï¼‰

**å¼€å‘ç¯å¢ƒ**ï¼šVS Code + PlatformIOï¼ˆæ¨èä½¿ç”¨ ESP-IDF 5.x å·¥å…·é“¾ï¼Œå®˜æ–¹æ”¯æŒ ESP-SRï¼‰

**PlatformIO é›†æˆè¦ç‚¹**ï¼š

1. **ä½¿ç”¨ ESP-IDF æ¡†æ¶**ï¼šåˆ›å»º `platform = espressif32` ä¸” `framework = espidf` çš„é¡¹ç›®ï¼Œé¿å…ä¸ Arduino æ¡†æ¶æ··ç”¨ã€‚
2. **ç‰ˆæœ¬é”å®š**ï¼šå›ºå®š ESP-IDF åˆ° 5.xï¼ˆä¸ ESP-SR/ESP-ADF å…¼å®¹ï¼‰ï¼Œé¿å…è‡ªåŠ¨å‡çº§é€ æˆä¾èµ–ç ´åã€‚
3. **ç»„ä»¶ç®¡ç†**ï¼šå°† ESP-SRã€ESP-ADF ä½œä¸ºå¤–éƒ¨ç»„ä»¶å¼•å…¥ï¼ˆ`components/` æˆ– `extra_components_dirs`ï¼‰ï¼Œä¿æŒä¸ ESP-IDF ç‰ˆæœ¬åŒ¹é…ã€‚
4. **PSRAM é…ç½®**ï¼šåœ¨ `sdkconfig` ä¸­å¯ç”¨ PSRAMï¼ˆN16R8 å¿…éœ€ï¼‰ï¼Œå¹¶è®¾ç½®åˆ° 8MBã€‚
5. **åˆ†åŒºè¡¨**ï¼šä¸ºè¯­éŸ³æ¨¡å‹ä¸éŸ³é¢‘ç¼“å­˜é¢„ç•™è¶³å¤Ÿ Flash åˆ†åŒºï¼ˆå»ºè®®è‡ªå®šä¹‰åˆ†åŒºè¡¨ï¼‰ã€‚
6. **ç¼–è¯‘ä¼˜åŒ–**ï¼šå¼€å¯ `Release` æ„å»ºï¼Œå¿…è¦æ—¶é’ˆå¯¹ WakeNet/MultiNet å¯ç”¨ `-O2` ä¼˜åŒ–ã€‚
7. **ä¸²å£ä¸ç›‘è§†**ï¼šåœ¨ PlatformIO ä¸­å›ºå®šä¸²å£ä¸æ³¢ç‰¹ç‡ï¼Œä¾¿äºæ—¥å¿—ä¸æ€§èƒ½åˆ†æã€‚

**æ ¸å¿ƒæ¡†æ¶/åº“**ï¼š

| åŠŸèƒ½ | æ–¹æ¡ˆ | è¯´æ˜ |
|------|------|------|
| å±å¹•é©±åŠ¨ | LovyanGFX | Sprite å±€éƒ¨åˆ·æ–°ï¼Œé«˜å¸§ç‡ |
| éŸ³é¢‘æ¡†æ¶ | ESP-ADF | I2S + ç¼–è§£ç  + éŸ³é¢‘æµæ°´çº¿ |
| è¯­éŸ³å”¤é†’ | ESP-SR WakeNet | æœ¬åœ°å”¤é†’è¯æ£€æµ‹ |
| æŒ‡ä»¤è¯†åˆ« | ESP-SR MultiNet | æœ¬åœ°ç®€å•æŒ‡ä»¤è¯†åˆ« |
| RGB ç¯å¸¦ | FastLED / ESP-IDF RMT | WS2812B é©±åŠ¨ |
| ä¼ æ„Ÿå™¨ | å„æ¨¡å—å®˜æ–¹åº“ | I2C è¯»å– |
| ç½‘ç»œé€šä¿¡ | WebSocket + MQTT | æœåŠ¡ç«¯é€šä¿¡ + æ™ºèƒ½å®¶å±… |

**å›ºä»¶æ¶æ„**ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ä¸»ä»»åŠ¡è°ƒåº¦                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚ éŸ³é¢‘ä»»åŠ¡ â”‚ â”‚ æ˜¾ç¤ºä»»åŠ¡ â”‚ â”‚ ä¼ æ„Ÿä»»åŠ¡ â”‚ â”‚ ç½‘ç»œä»»åŠ¡ â”‚           â”‚
â”‚  â”‚ Core 0  â”‚ â”‚ Core 1  â”‚ â”‚ Core 0  â”‚ â”‚ Core 1  â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜           â”‚
â”‚       â”‚          â”‚          â”‚          â”‚                   â”‚
â”‚       â–¼          â–¼          â–¼          â–¼                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                   äº‹ä»¶é˜Ÿåˆ—                           â”‚   â”‚
â”‚  â”‚  WAKE_WORD_DETECTED | USER_PROXIMITY | IDLE_TIMEOUT â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                          â”‚                                 â”‚
â”‚                          â–¼                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                   çŠ¶æ€æœº                             â”‚   â”‚
â”‚  â”‚  IDLE â†’ LISTENING â†’ PROCESSING â†’ SPEAKING â†’ IDLE   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 è¯­éŸ³å”¤é†’æ–¹æ¡ˆ

**æ¨èï¼šå¼€æºè‡ªå®šä¹‰å”¤é†’è¯æ–¹æ¡ˆï¼ˆä¸ä¾èµ–å‚å•†ä»˜è´¹å®šåˆ¶ï¼‰**

**å¯é€‰å®ç°è·¯å¾„**ï¼š
1. **ESP32 æœ¬åœ° KWS**ï¼šä½¿ç”¨ TensorFlow Lite Micro / ESP-DSP è®­ç»ƒå°å‹å…³é”®è¯æ¨¡å‹ï¼ˆå¦‚ DS-CNNï¼‰ï¼Œæ¨¡å‹éšå›ºä»¶å‘å¸ƒã€‚
2. **PC ç«¯å”¤é†’ + å›ä¼ **ï¼šç”¨å¼€æº KWSï¼ˆå¦‚ openWakeWord / Preciseï¼‰åœ¨ PC ä¾§æ£€æµ‹å”¤é†’è¯ï¼Œå†é€šçŸ¥ ESP32 è¿›å…¥å½•éŸ³æ¨¡å¼ã€‚
3. **æ··åˆç­–ç•¥**ï¼šESP32 å…ˆåšè½»é‡é¢„æ£€ï¼ŒPC ç«¯äºŒæ¬¡ç¡®è®¤ï¼Œé™ä½è¯¯è§¦å‘ã€‚

```c
// å”¤é†’è¯æ£€æµ‹ + æœ¬åœ°æŒ‡ä»¤è¯†åˆ«
#include "esp_wn_iface.h"
#include "esp_mn_iface.h"

// è‡ªå®šä¹‰å”¤é†’è¯ï¼ˆå¼€æºæ–¹æ¡ˆè‡ªè¡Œè®­ç»ƒ/å¯¼å…¥ï¼‰
// - ä¸ä¾èµ–å‚å•†å†…ç½®è¯åº“
// - è®­ç»ƒå¥½æ¨¡å‹åå›ºä»¶å†…ç½®æˆ–æ”¾åˆ°å¤–éƒ¨ Flash

// æœ¬åœ°æŒ‡ä»¤ï¼ˆæ— éœ€è”ç½‘ï¼‰
const char *commands[] = {
    "æ‰“å¼€ç¯",
    "å…³é—­ç¯", 
    "æ’­æ”¾éŸ³ä¹",
    "åœæ­¢æ’­æ”¾",
    "ç°åœ¨å‡ ç‚¹",
    "ä»Šå¤©å¤©æ°”",
};
```

**å”¤é†’æµç¨‹**ï¼š

```
æŒç»­ç›‘å¬ â”€â”€â–¶ WakeNetæ£€æµ‹ â”€â”€â–¶ æ£€æµ‹åˆ°å”¤é†’è¯
                               â”‚
                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â–¼                           â–¼
          åç»­æ˜¯ç®€å•æŒ‡ä»¤ï¼Ÿ              åç»­æ˜¯å¤æ‚é—®é¢˜ï¼Ÿ
                 â”‚                           â”‚
                 â–¼                           â–¼
          MultiNetæœ¬åœ°è¯†åˆ«             ä¸Šä¼ PCæœåŠ¡ç«¯
          ç›´æ¥æ‰§è¡ŒåŠ¨ä½œ                 LLMå¤„ç†å›å¤
```

### 4.3 æœåŠ¡ç«¯ï¼ˆPCï¼‰

**æŠ€æœ¯æ ˆ**ï¼šPython 3.10+ / FastAPI / WebSocket / MQTT

**æ ¸å¿ƒå¤„ç†æµç¨‹**ï¼š

```python
# server.py
from fastapi import FastAPI, WebSocket
from langchain_ollama import ChatOllama
from langchain.memory import ConversationBufferWindowMemory
import faster_whisper
import edge_tts
import json

app = FastAPI()

# ç”¨æˆ·è®°å¿†å­˜å‚¨
user_memories = {}

# åˆå§‹åŒ–æ¨¡å‹
whisper = faster_whisper.WhisperModel("large-v3-turbo")
llm = ChatOllama(model="deepseek-r1:8b")

def get_user_context(user_id: str) -> str:
    """è·å–ç”¨æˆ·è®°å¿†ä¸Šä¸‹æ–‡"""
    memory = user_memories.get(user_id, {})
    return f"""
    ç”¨æˆ·åï¼š{memory.get('name', 'æœ‹å‹')}
    åå¥½ï¼š{memory.get('preferences', [])}
    æœ€è¿‘è¯é¢˜ï¼š{memory.get('recent_topics', [])}
    """

def extract_mood(response: str) -> str:
    """ä»å›å¤ä¸­æå–æƒ…ç»ªæ ‡ç­¾"""
    # ç®€å•è§„åˆ™ or è®©LLMè‡ªå·±æ ‡æ³¨
    if any(word in response for word in ['å“ˆå“ˆ', 'å¤ªå¥½äº†', 'å¼€å¿ƒ']):
        return 'happy'
    elif any(word in response for word in ['æŠ±æ­‰', 'é—æ†¾', 'éš¾è¿‡']):
        return 'sad'
    elif any(word in response for word in ['å—¯...', 'è®©æˆ‘æƒ³æƒ³', 'è¿™ä¸ªé—®é¢˜']):
        return 'thinking'
    return 'neutral'

@app.websocket("/ws/{user_id}")
async def chat(websocket: WebSocket, user_id: str):
    await websocket.accept()
    
    while True:
        # 1. æ¥æ”¶éŸ³é¢‘
        audio_data = await websocket.receive_bytes()
        
        # 2. ASR
        segments, _ = whisper.transcribe(audio_data)
        text = "".join([s.text for s in segments])
        
        # 3. æ³¨å…¥è®°å¿†ä¸Šä¸‹æ–‡
        context = get_user_context(user_id)
        prompt = f"{context}\n\nç”¨æˆ·è¯´ï¼š{text}"
        
        # 4. LLM ç”Ÿæˆ
        response = llm.invoke(prompt)
        reply = response.content
        
        # 5. æå–æƒ…ç»ª
        mood = extract_mood(reply)
        
        # 6. å‘é€æƒ…ç»ªæ ‡ç­¾
        await websocket.send_json({"type": "mood", "mood": mood})
        
        # 7. TTS æµå¼æ¨é€
        communicate = edge_tts.Communicate(reply, voice="zh-CN-XiaoxiaoNeural")
        async for chunk in communicate.stream():
            if chunk["type"] == "audio":
                await websocket.send_bytes(chunk["data"])
        
        # 8. æ›´æ–°è®°å¿†
        update_memory(user_id, text, reply)
```

---

## 5. æ‹ŸäººåŒ–ä½“éªŒè®¾è®¡

### 5.1 æƒ…ç»ªç³»ç»Ÿ

**æƒ…ç»ªçŠ¶æ€å®šä¹‰**ï¼š

| æƒ…ç»ª | è§¦å‘æ¡ä»¶ | çœ¼ç›è¡¨ç° | RGB ç¯å¸¦ |
|------|---------|---------|---------|
| ğŸ˜Š å¼€å¿ƒ | æ­£é¢å›å¤ã€å¤¸å¥– | å¼¯æˆæœˆç‰™ï¼Œç³å­”æ”¾å¤§ | æš–é»„è‰²å¿«é€Ÿå‘¼å¸ |
| ğŸ˜¢ éš¾è¿‡ | è´Ÿé¢è¯é¢˜ã€é“æ­‰ | ä¸‹å‚ï¼Œæ³ªæ»´åŠ¨ç”» | è“è‰²ç¼“æ…¢å‘¼å¸ |
| ğŸ¤” æ€è€ƒ | å¤æ‚é—®é¢˜ã€ç­‰å¾… | å‘ä¸Šçœ‹ï¼Œç³å­”è½¬åœˆ | ç´«è‰²æµæ°´ |
| ğŸ˜  ç”Ÿæ°” | è¢«éª‚ã€ä¸æ»¡ | çœ‰æ¯›ä¸‹å‹ï¼Œç³å­”ç¼©å° | çº¢è‰²é—ªçƒ |
| ğŸ˜´ å›°äº† | é•¿æ—¶é—´ç©ºé—² | æ…¢æ…¢çœ¯èµ·ï¼Œæ‰“å“ˆæ¬  | æš—æ·¡æ©™è‰² |
| ğŸ˜² æƒŠè®¶ | æ„å¤–ä¿¡æ¯ | çå¤§ï¼Œç³å­”æ”¾å¤§ | ç™½è‰²é—ªçƒ |
| ğŸ˜ å‚²å¨‡ | ç‰¹å®šæ€§æ ¼æ¨¡å¼ | æ–œçœ¼ï¼Œå¾®å¾®ä¸Šæ‰¬ | ç²‰è‰² |

**å®ç°ä»£ç ç¤ºä¾‹**ï¼š

```cpp
// emotions.h
enum Emotion {
    HAPPY, SAD, THINKING, ANGRY, SLEEPY, SURPRISED, TSUNDERE, NEUTRAL
};

struct EmotionState {
    Emotion current;
    uint8_t intensity;  // 0-100 å¼ºåº¦
    uint32_t duration;  // æŒç»­æ—¶é—´
};

// çœ¼ç›ç»˜åˆ¶
void drawEmotion(Emotion emotion) {
    switch (emotion) {
        case HAPPY:
            // å¼¯æœˆç‰™çœ¼ç›
            sprite.fillCircle(120, 120, 80, TFT_WHITE);
            sprite.fillArc(120, 100, 60, 70, 200, 340, TFT_BLACK);
            break;
            
        case SAD:
            // ä¸‹å‚çœ¼ç› + æ³ªæ»´
            sprite.fillCircle(120, 130, 70, TFT_WHITE);
            sprite.fillCircle(120, 140, 30, TFT_BLACK);
            sprite.fillCircle(90, 160, 8, TFT_CYAN);  // æ³ªæ»´
            break;
            
        case THINKING:
            // çœ¼ç›å‘ä¸Šçœ‹
            sprite.fillCircle(120, 120, 80, TFT_WHITE);
            sprite.fillCircle(120, 90, 35, TFT_BLACK);  // ç³å­”ä¸Šç§»
            break;
            
        // ... å…¶ä»–æƒ…ç»ª
    }
    sprite.pushSprite(0, 0);
}
```

### 5.2 çœ¼ç¥è¿½è¸ª

**ä½¿ç”¨ VL53L0X æ¿€å…‰æµ‹è·ä¼ æ„Ÿå™¨æ£€æµ‹ç”¨æˆ·æ–¹ä½**ï¼š

```cpp
// eye_tracking.h
#include <VL53L0X.h>

VL53L0X distanceSensor;

struct UserPosition {
    int distance;      // è·ç¦» mm
    int direction;     // æ–¹å‘ï¼ˆéœ€è¦å¤šä¸ªä¼ æ„Ÿå™¨æˆ–æ‘„åƒå¤´ï¼‰
    bool isPresent;    // æ˜¯å¦æœ‰äºº
};

void updateEyeTracking() {
    int distance = distanceSensor.readRangeSingleMillimeters();
    
    if (distance < 500) {
        // ç”¨æˆ·å¾ˆè¿‘ï¼Œç³å­”æ”¾å¤§è¡¨ç¤ºå…³æ³¨
        pupilSize = 40;
        pupilY = 120;  // ç›´è§†
    } else if (distance < 1500) {
        // æ­£å¸¸è·ç¦»
        pupilSize = 30;
    } else {
        // ç”¨æˆ·è¾ƒè¿œæˆ–ç¦»å¼€
        pupilSize = 25;
        // çœ¼ç›å¯ä»¥"å¤±è½"åœ°ä½ä¸‹
        pupilY = 140;
    }
}

// å¦‚æœæœ‰å¤šä¸ªæµ‹è·ä¼ æ„Ÿå™¨ï¼Œå¯ä»¥åˆ¤æ–­å·¦å³
void trackUserDirection(int leftDist, int rightDist) {
    if (leftDist < rightDist - 100) {
        pupilX = 90;   // çœ‹å‘å·¦è¾¹
    } else if (rightDist < leftDist - 100) {
        pupilX = 150;  // çœ‹å‘å³è¾¹
    } else {
        pupilX = 120;  // çœ‹æ­£å‰æ–¹
    }
}
```

### 5.3 é—²ç½®åŠ¨ç”»

**è®© Wallace åœ¨æ— äº¤äº’æ—¶ä¹Ÿ"æ´»ç€"**ï¼š

```cpp
// idle_animations.h

enum IdleAction {
    LOOK_AROUND,      // éšæœºçœ‹çœ‹å››å‘¨
    BLINK,            // çœ¨çœ¼
    YAWN,             // æ‰“å“ˆæ¬ 
    CURIOUS_LOOK,     // å¥½å¥‡åœ°ç›¯ç€æŸå¤„
    SLIGHT_MOVEMENT,  // è½»å¾®æ™ƒåŠ¨
    HUM_TUNE,         // å“¼å°æ›²ï¼ˆæ’­æ”¾éŸ³æ•ˆï¼‰
};

void playIdleAnimation() {
    static uint32_t lastAction = 0;
    static uint32_t nextActionDelay = 3000;
    
    if (millis() - lastAction > nextActionDelay) {
        // éšæœºé€‰æ‹©ä¸€ä¸ªåŠ¨ä½œ
        IdleAction action = (IdleAction)random(0, 6);
        
        switch (action) {
            case LOOK_AROUND:
                // çœ¼ç›éšæœºçœ‹å‘æŸä¸ªæ–¹å‘ï¼Œ3ç§’åå›æ­£
                pupilX = random(80, 160);
                pupilY = random(90, 150);
                delay(2000);
                pupilX = 120;
                pupilY = 120;
                break;
                
            case BLINK:
                // å¿«é€Ÿçœ¨çœ¼
                for (int i = 0; i < 2; i++) {
                    drawBlinkFrame(true);
                    delay(80);
                    drawBlinkFrame(false);
                    delay(80);
                }
                break;
                
            case YAWN:
                // æ‰“å“ˆæ¬ åŠ¨ç”»
                playYawnAnimation();
                break;
                
            case HUM_TUNE:
                // 10% æ¦‚ç‡å“¼å°æ›²
                if (random(100) < 10) {
                    playRandomTune();
                }
                break;
        }
        
        lastAction = millis();
        nextActionDelay = random(3000, 10000);  // 3-10ç§’éšæœºé—´éš”
    }
}
```

### 5.4 å‘¼å¸ç¯æ•ˆæœ

**WS2812B RGB ç¯å¸¦çŠ¶æ€åé¦ˆ**ï¼š

```cpp
// led_effects.h
#include <FastLED.h>

#define NUM_LEDS 12
#define LED_PIN 48

CRGB leds[NUM_LEDS];

enum LedEffect {
    BREATHING,        // å‘¼å¸
    RAINBOW_CHASE,    // å½©è™¹è¿½é€
    PULSE,            // è„‰å†²
    AUDIO_REACTIVE,   // éŸ³é¢‘å“åº”
    ALERT,            // è­¦å‘Šé—ªçƒ
};

// çŠ¶æ€å¯¹åº”çš„ç¯æ•ˆ
void setLedState(SystemState state) {
    switch (state) {
        case STATE_IDLE:
            // æ·¡è“è‰²ç¼“æ…¢å‘¼å¸
            breathingEffect(CRGB::DodgerBlue, 3000);
            break;
            
        case STATE_LISTENING:
            // äº®èµ·æ¸å˜å…‰ç¯
            rainbowChase(50);
            break;
            
        case STATE_THINKING:
            // ç´«è‰²æµæ°´è¿½é€
            chaseEffect(CRGB::Purple, 100);
            break;
            
        case STATE_SPEAKING:
            // éšéŸ³é¢‘æŒ¯å¹…å¾‹åŠ¨
            audioReactiveEffect();
            break;
            
        case STATE_LOW_BATTERY:
            // çº¢è‰²é—ªçƒè­¦å‘Š
            blinkEffect(CRGB::Red, 500);
            break;
    }
}

// éŸ³é¢‘å“åº”æ•ˆæœ
void audioReactiveEffect() {
    // ä»éŸ³é¢‘ç¼“å†²åŒºè®¡ç®—æŒ¯å¹…
    int amplitude = getAudioAmplitude();
    int brightness = map(amplitude, 0, 4096, 50, 255);
    
    for (int i = 0; i < NUM_LEDS; i++) {
        leds[i] = CHSV(160, 255, brightness);  // è“ç»¿è‰²
    }
    FastLED.show();
}
```

---

## 6. AI èƒ½åŠ›æ‰©å±•

### 6.1 è®°å¿†ç³»ç»Ÿ

**è®© Wallace è®°ä½ç”¨æˆ·**ï¼š

```python
# memory_system.py
import json
from datetime import datetime
from pathlib import Path

class UserMemory:
    def __init__(self, user_id: str):
        self.user_id = user_id
        self.file_path = Path(f"memories/{user_id}.json")
        self.load()
    
    def load(self):
        if self.file_path.exists():
            with open(self.file_path) as f:
                self.data = json.load(f)
        else:
            self.data = {
                "name": None,
                "preferences": [],
                "interests": [],
                "recent_topics": [],
                "important_dates": {},
                "interaction_count": 0,
                "first_met": datetime.now().isoformat(),
            }
    
    def save(self):
        self.file_path.parent.mkdir(exist_ok=True)
        with open(self.file_path, 'w') as f:
            json.dump(self.data, f, ensure_ascii=False, indent=2)
    
    def update_from_conversation(self, user_text: str, ai_response: str):
        """ä»å¯¹è¯ä¸­æå–å¹¶æ›´æ–°è®°å¿†"""
        self.data["interaction_count"] += 1
        
        # æå–ç”¨æˆ·å
        if "æˆ‘å«" in user_text or "æˆ‘æ˜¯" in user_text:
            # ç®€å•æå–ï¼Œå®é™…å¯ç”¨NER
            name = extract_name(user_text)
            if name:
                self.data["name"] = name
        
        # æå–åå¥½
        if "å–œæ¬¢" in user_text:
            preference = extract_preference(user_text)
            if preference and preference not in self.data["preferences"]:
                self.data["preferences"].append(preference)
        
        # æ›´æ–°æœ€è¿‘è¯é¢˜ï¼ˆä¿ç•™æœ€è¿‘5ä¸ªï¼‰
        topic = summarize_topic(user_text)
        self.data["recent_topics"].insert(0, {
            "topic": topic,
            "time": datetime.now().isoformat()
        })
        self.data["recent_topics"] = self.data["recent_topics"][:5]
        
        self.save()
    
    def get_context_prompt(self) -> str:
        """ç”Ÿæˆè®°å¿†ä¸Šä¸‹æ–‡æç¤ºè¯"""
        name = self.data.get("name") or "æœ‹å‹"
        prefs = ", ".join(self.data.get("preferences", [])) or "æš‚æœªäº†è§£"
        
        recent = ""
        if self.data.get("recent_topics"):
            recent = f"ä¸Šæ¬¡èŠäº†ï¼š{self.data['recent_topics'][0]['topic']}"
        
        return f"""
ä½ æ­£åœ¨å’Œ{name}å¯¹è¯ã€‚
ä½ äº†è§£åˆ°taçš„åå¥½ï¼š{prefs}
{recent}
è¯·æ ¹æ®è¿™äº›ä¿¡æ¯ï¼Œç”¨äº²åˆ‡è‡ªç„¶çš„è¯­æ°”å›å¤ã€‚
"""
```

**æ•ˆæœç¤ºä¾‹**ï¼š

```
ç¬¬ä¸€æ¬¡å¯¹è¯ï¼š
ç”¨æˆ·ï¼š"ä½ å¥½ï¼Œæˆ‘å«å°æ˜"
Wallaceï¼š"ä½ å¥½å°æ˜ï¼å¾ˆé«˜å…´è®¤è¯†ä½ ï½æœ‰ä»€ä¹ˆæˆ‘å¯ä»¥å¸®ä½ çš„å—ï¼Ÿ"

ä¸€å‘¨åï¼š
ç”¨æˆ·ï¼š"æ—©ä¸Šå¥½"
Wallaceï¼š"æ—©ä¸Šå¥½å°æ˜ï¼è®°å¾—ä½ è¯´è¿‡æ—©èµ·å›°éš¾ï¼Œä»Šå¤©èµ·å¾—æŒºæ—©å•Šï¼Œæ˜¯æœ‰ä»€ä¹ˆé‡è¦çš„äº‹å—ï¼Ÿ"
```

### 6.2 ä¸»åŠ¨å…³æ€€

**å®šæ—¶ä»»åŠ¡ + äº‹ä»¶è§¦å‘**ï¼š

```python
# proactive_care.py
from apscheduler.schedulers.asyncio import AsyncIOScheduler
import httpx

scheduler = AsyncIOScheduler()

# å®šæ—¶æé†’
@scheduler.scheduled_job('interval', hours=2)
async def sedentary_reminder():
    """ä¹…åæé†’"""
    await send_to_device("å·²ç»åäº†ä¸¤ä¸ªå°æ—¶äº†ï¼Œè¦ä¸è¦ç«™èµ·æ¥æ´»åŠ¨ä¸€ä¸‹ï¼Ÿ", mood="caring")

@scheduler.scheduled_job('cron', hour=7, minute=30)
async def morning_greeting():
    """æ—©å®‰é—®å€™ + å¤©æ°”"""
    weather = await get_weather()
    msg = f"æ—©ä¸Šå¥½ï¼ä»Šå¤©{weather['description']}ï¼Œæ°”æ¸©{weather['temp']}åº¦ã€‚"
    if weather['temp'] < 10:
        msg += "æœ‰ç‚¹å†·ï¼Œè®°å¾—å¤šç©¿ç‚¹å“¦ï½"
    await send_to_device(msg, mood="happy")

@scheduler.scheduled_job('cron', hour=22, minute=0)
async def night_reminder():
    """æ™šå®‰æé†’"""
    await send_to_device("å·²ç»åç‚¹äº†ï¼Œä»Šå¤©è¾›è‹¦äº†ï¼Œæ—©ç‚¹ä¼‘æ¯å§ï½", mood="gentle")

# ç‰¹æ®Šæ—¥æœŸæé†’
async def check_special_dates(user_memory):
    today = datetime.now().strftime("%m-%d")
    important_dates = user_memory.data.get("important_dates", {})
    
    if today in important_dates:
        event = important_dates[today]
        if event["type"] == "birthday":
            await send_to_device(
                f"ä»Šå¤©æ˜¯ä½ çš„ç”Ÿæ—¥ï¼ç¥ä½ ç”Ÿæ—¥å¿«ä¹ï¼ğŸ‚ğŸ‰", 
                mood="excited"
            )
```

### 6.3 å¤šæ¨¡æ€è¾“å…¥

**OV2640 æ‘„åƒå¤´æ‰©å±•**ï¼š

```cpp
// camera_features.h
#include "esp_camera.h"
#include "human_face_detect_msr01.hpp"

// äººè„¸æ£€æµ‹
void detectFace() {
    camera_fb_t *fb = esp_camera_fb_get();
    if (!fb) return;
    
    // ä½¿ç”¨ ESP-WHO äººè„¸æ£€æµ‹
    std::list<dl::detect::result_t> results;
    detector.infer((uint8_t *)fb->buf, {fb->height, fb->width, 3});
    results = detector.get_results();
    
    if (!results.empty()) {
        // æ£€æµ‹åˆ°äººè„¸
        onFaceDetected(results.front());
    }
    
    esp_camera_fb_return(fb);
}

void onFaceDetected(dl::detect::result_t &face) {
    // è®¡ç®—äººè„¸ä½ç½®ï¼Œè°ƒæ•´çœ¼ç¥
    int face_center_x = (face.box[0] + face.box[2]) / 2;
    
    if (face_center_x < fb->width / 3) {
        lookLeft();
    } else if (face_center_x > fb->width * 2 / 3) {
        lookRight();
    } else {
        lookCenter();
    }
}
```

### 6.4 æœ¬åœ°æŒ‡ä»¤è¯†åˆ«

**ç®€å•æŒ‡ä»¤æ— éœ€è”ç½‘**ï¼š

```cpp
// local_commands.h
#include "esp_mn_iface.h"

// å®šä¹‰æœ¬åœ°æŒ‡ä»¤
const char *local_commands[] = {
    "æ‰“å¼€ç¯",      // ID: 0
    "å…³é—­ç¯",      // ID: 1
    "è°ƒäº®ä¸€ç‚¹",    // ID: 2
    "è°ƒæš—ä¸€ç‚¹",    // ID: 3
    "æ’­æ”¾éŸ³ä¹",    // ID: 4
    "æš‚åœ",        // ID: 5
    "ç°åœ¨å‡ ç‚¹",    // ID: 6
    "ä»Šå¤©æ˜ŸæœŸå‡ ",  // ID: 7
    "è®¾ç½®é—¹é’Ÿ",    // ID: 8
    "å–æ¶ˆé—¹é’Ÿ",    // ID: 9
};

void handleLocalCommand(int command_id) {
    switch (command_id) {
        case 0: // æ‰“å¼€ç¯
            mqtt_publish("home/light/bedroom", "ON");
            speak("å¥½çš„ï¼Œç¯å·²æ‰“å¼€");
            break;
            
        case 1: // å…³é—­ç¯
            mqtt_publish("home/light/bedroom", "OFF");
            speak("å¥½çš„ï¼Œç¯å·²å…³é—­");
            break;
            
        case 6: // ç°åœ¨å‡ ç‚¹
            char timeStr[32];
            getLocalTime(&timeinfo);
            sprintf(timeStr, "ç°åœ¨æ˜¯%dç‚¹%dåˆ†", timeinfo.tm_hour, timeinfo.tm_min);
            speak(timeStr);
            break;
            
        // ... å…¶ä»–æŒ‡ä»¤
    }
}
```

---

## 7. ç¯å¢ƒæ„ŸçŸ¥ä¸æ™ºèƒ½å®¶å±…

### 7.1 ç¯å¢ƒä¼ æ„Ÿå™¨

| ä¼ æ„Ÿå™¨ | å‹å· | åŠŸèƒ½ | äº¤äº’ç¤ºä¾‹ |
|--------|------|------|---------|
| æ¸©æ¹¿åº¦ | DHT22 | ç¯å¢ƒèˆ’é€‚åº¦ | "ç°åœ¨å®¤å†…26åº¦ï¼Œæ¹¿åº¦60%ï¼ŒæŒºèˆ’é€‚çš„" |
| å…‰çº¿ | BH1750 | å…‰ç…§å¼ºåº¦ | "å…‰çº¿æœ‰ç‚¹æš—ï¼Œè¦ä¸è¦å¼€ç¯ï¼Ÿ" |
| ç©ºæ°”è´¨é‡ | MQ-135 | æœ‰å®³æ°”ä½“ | "ç©ºæ°”è´¨é‡ä¸å¤ªå¥½ï¼Œå»ºè®®å¼€çª—é€šé£" |
| æ°”å‹ | BMP280 | å¤©æ°”å˜åŒ– | "æ°”å‹åœ¨ä¸‹é™ï¼Œå¯èƒ½è¦ä¸‹é›¨äº†" |

**ç¯å¢ƒç›‘æµ‹ä»£ç **ï¼š

```cpp
// environment_monitor.h
#include <DHT.h>
#include <BH1750.h>

DHT dht(DHT_PIN, DHT22);
BH1750 lightMeter;

struct Environment {
    float temperature;
    float humidity;
    uint16_t light;
    bool isComfortable;
};

Environment readEnvironment() {
    Environment env;
    env.temperature = dht.readTemperature();
    env.humidity = dht.readHumidity();
    env.light = lightMeter.readLightLevel();
    
    // åˆ¤æ–­èˆ’é€‚åº¦
    env.isComfortable = (env.temperature >= 20 && env.temperature <= 26 &&
                         env.humidity >= 40 && env.humidity <= 60);
    
    return env;
}

// ä¸»åŠ¨æé†’
void checkEnvironmentAlerts(Environment &env) {
    if (env.temperature > 28) {
        queueMessage("æœ‰ç‚¹çƒ­äº†ï¼Œè¦ä¸è¦å¼€ç©ºè°ƒï¼Ÿ", MOOD_CARING);
    }
    
    if (env.humidity < 30) {
        queueMessage("ç©ºæ°”æœ‰ç‚¹å¹²ç‡¥ï¼Œè®°å¾—å¤šå–æ°´å“¦", MOOD_CARING);
    }
    
    if (env.light < 100 && isEvening()) {
        queueMessage("å…‰çº¿æœ‰ç‚¹æš—äº†ï¼Œè¦ä¸è¦å¼€ç¯ï¼Ÿ", MOOD_CURIOUS);
    }
}
```

### 7.2 æ™ºèƒ½å®¶å±…è”åŠ¨

**MQTT æ§åˆ¶åè®®**ï¼š

```cpp
// smart_home.h
#include <PubSubClient.h>

WiFiClient espClient;
PubSubClient mqtt(espClient);

// è®¾å¤‡å®šä¹‰
struct SmartDevice {
    const char *name;
    const char *topic;
    const char *type;  // light, switch, climate, etc.
};

SmartDevice devices[] = {
    {"å§å®¤ç¯", "home/light/bedroom", "light"},
    {"å®¢å…ç¯", "home/light/living", "light"},
    {"ç©ºè°ƒ", "home/climate/ac", "climate"},
    {"åŠ æ¹¿å™¨", "home/switch/humidifier", "switch"},
};

void controlDevice(const char *deviceName, const char *action) {
    for (auto &dev : devices) {
        if (strcmp(dev.name, deviceName) == 0) {
            mqtt.publish(dev.topic, action);
            return;
        }
    }
}

// åœºæ™¯æ§åˆ¶
void executeScene(const char *sceneName) {
    if (strcmp(sceneName, "ç¡è§‰") == 0) {
        controlDevice("å§å®¤ç¯", "OFF");
        controlDevice("å®¢å…ç¯", "OFF");
        mqtt.publish("home/climate/ac", "{\"mode\":\"sleep\"}");
        speak("å¥½çš„ï¼Œæ™šå®‰ï½");
    }
    else if (strcmp(sceneName, "èµ·åºŠ") == 0) {
        controlDevice("å§å®¤ç¯", "ON");
        // æ¸äº®æ•ˆæœ
        for (int i = 0; i <= 100; i += 10) {
            char brightness[16];
            sprintf(brightness, "{\"brightness\":%d}", i);
            mqtt.publish("home/light/bedroom", brightness);
            delay(500);
        }
        speak("æ—©ä¸Šå¥½ï¼Œæ–°çš„ä¸€å¤©å¼€å§‹äº†ï¼");
    }
}
```

---

## 8. è¶£å‘³ç©æ³•

### 8.1 å°æ¸¸æˆæ¨¡å¼

**çŒœæ•°å­—**ï¼š

```cpp
// games/guess_number.h
class GuessNumberGame {
    int secretNumber;
    int attempts;
    int maxAttempts = 7;
    
public:
    void start() {
        secretNumber = random(1, 101);
        attempts = 0;
        speak("æˆ‘æƒ³äº†ä¸€ä¸ª1åˆ°100ä¹‹é—´çš„æ•°å­—ï¼Œä½ æ¥çŒœçŒœçœ‹ï¼");
        setEmotion(PLAYFUL);
    }
    
    void guess(int number) {
        attempts++;
        
        if (number == secretNumber) {
            speak(String("æ­å–œä½ çŒœå¯¹äº†ï¼ç”¨äº†") + attempts + "æ¬¡ï¼");
            setEmotion(EXCITED);
            showWinAnimation();
        }
        else if (attempts >= maxAttempts) {
            speak(String("å¾ˆé—æ†¾ï¼Œç­”æ¡ˆæ˜¯") + secretNumber + "ï¼Œä¸‹æ¬¡å†æŒ‘æˆ˜å§ï¼");
            setEmotion(SAD);
        }
        else if (number > secretNumber) {
            speak("å¤§äº†ï¼Œå†çŒœå°ä¸€ç‚¹ï½");
            showHintAnimation(false);  // å‘ä¸‹ç®­å¤´
        }
        else {
            speak("å°äº†ï¼Œå†çŒœå¤§ä¸€ç‚¹ï½");
            showHintAnimation(true);   // å‘ä¸Šç®­å¤´
        }
    }
};
```

**æˆè¯­æ¥é¾™**ï¼š

```python
# games/idiom_chain.py
class IdiomChainGame:
    def __init__(self):
        self.idioms = load_idiom_database()
        self.used = set()
        self.last_char = None
    
    def player_turn(self, idiom: str) -> str:
        # éªŒè¯æˆè¯­
        if idiom not in self.idioms:
            return "[mood:confused] è¿™ä¸ªå¥½åƒä¸æ˜¯æˆè¯­å“¦ï¼Œæ¢ä¸€ä¸ªè¯•è¯•ï¼Ÿ"
        
        # éªŒè¯é¦–å­—
        if self.last_char and idiom[0] != self.last_char:
            return f"[mood:playful] è¦ç”¨'{self.last_char}'å¼€å¤´å“¦ï¼"
        
        # éªŒè¯æ˜¯å¦ç”¨è¿‡
        if idiom in self.used:
            return "[mood:thinking] è¿™ä¸ªè¯´è¿‡äº†ï¼Œæ¢ä¸€ä¸ªå§ï¼"
        
        self.used.add(idiom)
        self.last_char = idiom[-1]
        
        # AI æ¥é¾™
        ai_idiom = self.find_idiom(self.last_char)
        if ai_idiom:
            self.used.add(ai_idiom)
            self.last_char = ai_idiom[-1]
            return f"[mood:happy] {ai_idiom}ï¼è½®åˆ°ä½ äº†ï¼Œ'{self.last_char}'å¼€å¤´ï½"
        else:
            return "[mood:surprised] æˆ‘æƒ³ä¸å‡ºæ¥äº†ï¼Œä½ èµ¢äº†ï¼"
```

### 8.2 æ¡Œé¢å® ç‰©æ¨¡å¼

**è‡ªä¸»è¡Œä¸ºçŠ¶æ€æœº**ï¼š

```cpp
// pet_mode.h
enum PetState {
    PET_IDLE,       // å‘å‘†
    PET_CURIOUS,    // å¥½å¥‡
    PET_PLAYFUL,    // æƒ³ç©
    PET_SLEEPY,     // å›°äº†
    PET_HUNGRY,     // é¥¿äº†ï¼ˆéœ€è¦"å–‚é£Ÿ"äº’åŠ¨ï¼‰
};

class DesktopPet {
    PetState state = PET_IDLE;
    int happiness = 50;    // 0-100
    int energy = 100;      // 0-100
    uint32_t lastInteraction = 0;
    
public:
    void update() {
        uint32_t now = millis();
        uint32_t idleTime = now - lastInteraction;
        
        // èƒ½é‡éšæ—¶é—´ä¸‹é™
        energy = max(0, energy - 1);
        
        // æ ¹æ®èƒ½é‡åˆ‡æ¢çŠ¶æ€
        if (energy < 20) {
            setState(PET_SLEEPY);
        }
        else if (idleTime > 60000 && random(100) < 5) {
            // é•¿æ—¶é—´æ— äº’åŠ¨ï¼Œå¯èƒ½ä¼šä¸»åŠ¨æ‰¾ä½ ç©
            setState(PET_PLAYFUL);
            speak("é™ªæˆ‘ç©ä¼šå„¿å˜›ï½");
        }
        else if (random(100) < 2) {
            // éšæœºå¥½å¥‡
            setState(PET_CURIOUS);
            lookAtRandomDirection();
        }
        
        // æ˜¾ç¤ºå½“å‰çŠ¶æ€åŠ¨ç”»
        showPetAnimation(state);
    }
    
    void interact(InteractionType type) {
        lastInteraction = millis();
        
        switch (type) {
            case INTERACT_PET:   // æ‘¸æ‘¸å¤´ï¼ˆè§¦æ‘¸ä¼ æ„Ÿå™¨ï¼‰
                happiness = min(100, happiness + 10);
                showHeartAnimation();
                speak("å˜¿å˜¿ï½");
                break;
                
            case INTERACT_FEED:  // å–‚é£Ÿï¼ˆè¯´"åƒä¸œè¥¿"ï¼‰
                energy = min(100, energy + 30);
                showEatingAnimation();
                speak("å¥½åƒï¼è°¢è°¢ï½");
                break;
                
            case INTERACT_PLAY:  // ç©æ¸¸æˆ
                happiness = min(100, happiness + 20);
                energy = max(0, energy - 10);
                startMiniGame();
                break;
        }
    }
};
```

### 8.3 å®ç”¨å·¥å…·

**ç•ªèŒ„é’Ÿ**ï¼š

```cpp
// tools/pomodoro.h
class PomodoroTimer {
    int workMinutes = 25;
    int breakMinutes = 5;
    int sessions = 0;
    
public:
    void start() {
        speak("ç•ªèŒ„é’Ÿå¼€å§‹ï¼ä¸“æ³¨25åˆ†é’Ÿï½");
        showTimerOnScreen(workMinutes * 60);
        setEmotion(FOCUSED);
        
        // å®šæ—¶å™¨å›è°ƒ
        esp_timer_create(&timer_args, &timer_handle);
        esp_timer_start_once(timer_handle, workMinutes * 60 * 1000000);
    }
    
    void onWorkComplete() {
        sessions++;
        speak("æ—¶é—´åˆ°ï¼ä¼‘æ¯5åˆ†é’Ÿå§ï½");
        setEmotion(RELAXED);
        showBreakAnimation();
        
        // æ¯4ä¸ªç•ªèŒ„é’Ÿé•¿ä¼‘æ¯
        if (sessions % 4 == 0) {
            speak("å·²ç»å®Œæˆ4ä¸ªç•ªèŒ„é’Ÿäº†ï¼Œä¼‘æ¯15åˆ†é’Ÿå§ï¼");
        }
    }
};
```

**é˜…è¯»åŠ©æ‰‹**ï¼ˆéœ€è¦æ‘„åƒå¤´ï¼‰ï¼š

```python
# tools/reading_assistant.py
import pytesseract
from PIL import Image

async def read_page(image_bytes: bytes) -> str:
    """OCR è¯†åˆ«é¡µé¢æ–‡å­—"""
    image = Image.open(io.BytesIO(image_bytes))
    text = pytesseract.image_to_string(image, lang='chi_sim+eng')
    return text

async def explain_word(word: str) -> str:
    """è§£é‡Šå•è¯/è¯è¯­"""
    prompt = f"è¯·ç”¨ç®€å•æ˜“æ‡‚çš„æ–¹å¼è§£é‡Š'{word}'çš„æ„æ€ï¼Œå¹¶ç»™å‡ºä¸€ä¸ªä¾‹å¥ã€‚"
    response = await llm.ainvoke(prompt)
    return response.content
```

### 8.4 å½©è›‹åŠŸèƒ½

**ç‰©ç†æŒ‰é’®è§¦å‘**ï¼š

```cpp
// easter_eggs.h
#include <OneButton.h>

OneButton easterButton(GPIO_NUM_0, true);

void setupEasterEggs() {
    // è¿æŒ‰ä¸‰ä¸‹ï¼šåˆ‡æ¢æ€§æ ¼
    easterButton.attachMultiClick([]() {
        int clicks = easterButton.getNumberClicks();
        if (clicks == 3) {
            cyclePersonality();
        }
    });
    
    // é•¿æŒ‰3ç§’ï¼šæ ‘æ´æ¨¡å¼
    easterButton.attachLongPressStart([]() {
        enterTreeHoleMode();
    });
}

// æ€§æ ¼åˆ‡æ¢
enum Personality {
    PERSONALITY_NORMAL,    // æ™®é€š
    PERSONALITY_COLD,      // é«˜å†·
    PERSONALITY_CHATTY,    // è¯ç—¨
    PERSONALITY_TSUNDERE,  // å‚²å¨‡
};

void cyclePersonality() {
    currentPersonality = (Personality)((currentPersonality + 1) % 4);
    
    switch (currentPersonality) {
        case PERSONALITY_NORMAL:
            speak("å¥½çš„ï¼Œæ¢å¤æ­£å¸¸æ¨¡å¼ï½");
            break;
        case PERSONALITY_COLD:
            speak("å“¦ã€‚");
            break;
        case PERSONALITY_CHATTY:
            speak("å¤ªå¥½äº†å¤ªå¥½äº†ï¼æˆ‘æœ€å–œæ¬¢èŠå¤©äº†ï¼ä½ ä»Šå¤©æ€ä¹ˆæ ·ï¼Ÿåƒäº†å—ï¼Ÿæœ€è¿‘åœ¨å¿™ä»€ä¹ˆå‘€ï¼Ÿ");
            break;
        case PERSONALITY_TSUNDERE:
            speak("å“¼ï¼Œæ‰ä¸æ˜¯ä¸ºäº†ä½ æ‰æ¢çš„æ¨¡å¼å‘¢ï¼");
            break;
    }
}

// æ ‘æ´æ¨¡å¼ï¼šåªå¬ä¸è¯´ï¼Œä¸è®°å½•
void enterTreeHoleMode() {
    speak("è¿›å…¥æ ‘æ´æ¨¡å¼ã€‚æˆ‘ä¼šå®‰é™åœ°å¬ä½ è¯´ï¼Œä¸ä¼šè®°å½•ä»»ä½•å†…å®¹ã€‚");
    setEmotion(GENTLE);
    disableMemory();
    disableCloudUpload();
}
```

**æ‘‡ä¸€æ‘‡**ï¼ˆéœ€è¦ MPU6050ï¼‰ï¼š

```cpp
// æ£€æµ‹æ‘‡æ™ƒ
void checkShake() {
    int16_t ax, ay, az;
    mpu.getAcceleration(&ax, &ay, &az);
    
    float magnitude = sqrt(ax*ax + ay*ay + az*az);
    
    if (magnitude > SHAKE_THRESHOLD) {
        // éšæœºå†·çŸ¥è¯†
        String fact = getRandomFact();
        speak("ä½ çŸ¥é“å—ï¼Ÿ" + fact);
        setEmotion(SURPRISED);
    }
}
```

---

## 9. ç”µæºç®¡ç†ç­–ç•¥

### 9.1 ä¾›ç”µæ¶æ„

```
18650 ç”µæ±  (3.7V, 2500mAh)
    â”‚
    â–¼
TP4056 å……ç”µä¿æŠ¤æ¨¡å— (Type-C)
    â”‚
    â”œâ”€â”€â–¶ MT3608 å‡å‹ â”€â”€â–¶ 5V
    â”‚         â”‚
    â”‚         â”œâ”€â”€â–¶ MAX98357A åŠŸæ”¾
    â”‚         â”œâ”€â”€â–¶ WS2812B RGB ç¯å¸¦
    â”‚         â””â”€â”€â–¶ ESP32-S3 (5V Pin)
    â”‚                   â”‚
    â”‚                   â””â”€â”€â–¶ æ¿è½½ LDO â”€â”€â–¶ 3.3V
    â”‚                                       â”‚
    â”‚                                       â”œâ”€â”€â–¶ INMP441 éº¦å…‹é£
    â”‚                                       â”œâ”€â”€â–¶ GC9A01 å±å¹•
    â”‚                                       â””â”€â”€â–¶ I2C ä¼ æ„Ÿå™¨
    â”‚
    â””â”€â”€â–¶ ç”µæ± ç”µå‹æ£€æµ‹ (ADC)
              â”‚
              â””â”€â”€â–¶ ä½ç”µé‡è­¦å‘Š (<3.3V)
```

### 9.2 åŠŸè€—é¢„ä¼°ä¸ç»­èˆª

| å·¥ä½œçŠ¶æ€ | åŠŸè€— | è¯´æ˜ |
|---------|------|------|
| è¯­éŸ³å”¤é†’å¾…æœº | ~25mA | éº¦å…‹é£ + WakeNet + é—²ç½®åŠ¨ç”» |
| å”¤é†’åå½•éŸ³ | ~80mA | + WiFi è¿æ¥ |
| æ’­æ”¾å›å¤ | ~150mA | + åŠŸæ”¾å…¨åŠŸç‡ + å±å¹•æœ€äº® |
| å…¨åŠŸèƒ½è¿è¡Œ | ~200mA | + RGB ç¯å¸¦ + ä¼ æ„Ÿå™¨ |
| æ·±åº¦ç¡çœ  | ~10Î¼A | ä»… RTC + è§¦æ‘¸å”¤é†’ |

**ç»­èˆªä¼°ç®—ï¼ˆ2500mAh ç”µæ± ï¼‰**ï¼š

| ä½¿ç”¨æ¨¡å¼ | é¢„ä¼°ç»­èˆª |
|---------|---------|
| çº¯è¯­éŸ³å”¤é†’å¾…æœºï¼ˆé—²ç½®åŠ¨ç”»å¼€ï¼‰ | çº¦ 80 å°æ—¶ï¼ˆ3.3 å¤©ï¼‰ |
| æ¯å¤© 50 æ¬¡å¯¹è¯ï¼ˆæ¯æ¬¡ 30 ç§’ï¼‰ | çº¦ 3 å¤© |
| æ·±åº¦ç¡çœ  + è§¦æ‘¸å”¤é†’ | æ•°æœˆ |
| å…¨åŠŸèƒ½æŒç»­è¿è¡Œ | çº¦ 12 å°æ—¶ |

### 9.3 ä½åŠŸè€—ä¼˜åŒ–ç­–ç•¥

**åˆ†çº§åŠŸè€—ç®¡ç†**ï¼š

```cpp
// power_management.h
enum PowerMode {
    POWER_FULL,       // å…¨åŠŸèƒ½
    POWER_NORMAL,     // æ­£å¸¸ï¼ˆå…³é—­éƒ¨åˆ†ä¼ æ„Ÿå™¨ï¼‰
    POWER_SAVING,     // çœç”µï¼ˆå…³é—­ç¯å¸¦ã€é™ä½å±å¹•äº®åº¦ï¼‰
    POWER_ULTRA_LOW,  // è¶…ä½åŠŸè€—ï¼ˆå…³é—­å±å¹•ã€åªä¿ç•™å”¤é†’ï¼‰
    POWER_SLEEP,      // æ·±åº¦ç¡çœ 
};

void setPowerMode(PowerMode mode) {
    switch (mode) {
        case POWER_FULL:
            setCpuFrequencyMhz(240);
            enableAllSensors();
            setScreenBrightness(255);
            enableRgbLed();
            break;
            
        case POWER_NORMAL:
            setCpuFrequencyMhz(160);
            disableCamera();
            setScreenBrightness(200);
            break;
            
        case POWER_SAVING:
            setCpuFrequencyMhz(80);
            disableRgbLed();
            setScreenBrightness(100);
            disableAllSensorsExceptMic();
            break;
            
        case POWER_ULTRA_LOW:
            setCpuFrequencyMhz(80);
            disableScreen();
            disableRgbLed();
            disableAllSensorsExceptMic();
            break;
            
        case POWER_SLEEP:
            esp_sleep_enable_ext0_wakeup(GPIO_NUM_1, HIGH);
            esp_deep_sleep_start();
            break;
    }
}

// è‡ªåŠ¨åˆ‡æ¢ç­–ç•¥
void autoPowerManagement() {
    float batteryVoltage = readBatteryVoltage();
    uint32_t idleTime = getIdleTime();
    
    if (batteryVoltage < 3.3) {
        // ä½ç”µé‡è­¦å‘Š
        speak("ç”µé‡ä¸è¶³ï¼Œè¯·å……ç”µ");
        setPowerMode(POWER_ULTRA_LOW);
    }
    else if (idleTime > 30 * 60 * 1000) {
        // 30åˆ†é’Ÿæ— äº¤äº’
        setPowerMode(POWER_SLEEP);
    }
    else if (idleTime > 5 * 60 * 1000) {
        // 5åˆ†é’Ÿæ— äº¤äº’
        setPowerMode(POWER_SAVING);
    }
}
```

---

## 10. ç¡¬ä»¶é‡‡è´­æ¸…å•ï¼ˆBOMï¼‰

### 10.1 æ ¸å¿ƒæ¨¡å—ï¼ˆå¿…é€‰ï¼‰

| ç±»åˆ« | åç§° | è§„æ ¼ | æ•°é‡ | å‚è€ƒä»· | å¤‡æ³¨ |
|------|------|------|------|-------|------|
| ä¸»æ§ | ESP32-S3 å¼€å‘æ¿ | N16R8ï¼ŒType-Cï¼ŒåŒ USB | 2 | Â¥35-50 | âš ï¸ æ£€æŸ¥ 5V å¼•è„š |
| æ˜¾ç¤º | GC9A01 åœ†å½¢å± | 1.28å¯¸ï¼ŒSPIï¼Œå¸¦åº•æ¿ | 1 | Â¥15-25 | å¿…é¡»å¸¦åº•æ¿ |
| éŸ³é¢‘è¾“å…¥ | INMP441 éº¦å…‹é£ | I2S æ•°å­—éº¦å…‹é£ | 2 | Â¥8-12 | - |
| éŸ³é¢‘è¾“å‡º | MAX98357A åŠŸæ”¾ | I2Sï¼Œ3W Dç±» | 2 | Â¥6-10 | éœ€ 5V ä¾›ç”µ |
| å‘å£° | è…”ä½“å–‡å­ | 4Î© 3Wï¼Œå¸¦éŸ³è…” | 1 | Â¥5-10 | å¿…é¡»å¸¦éŸ³è…” |
| ç”µæ±  | 18650 ç”µæ± +ç›’ | 2500mAh+ | 1ç»„ | Â¥15-25 | - |
| å……ç”µ | TP4056 æ¨¡å— | Type-Cï¼Œå¸¦ä¿æŠ¤ | 2 | Â¥3-5 | - |
| å‡å‹ | MT3608 æ¨¡å— | DC-DC 2A | 2 | Â¥2-4 | è°ƒè‡³ 5V |
| ç¯æ•ˆ | WS2812B ç¯å¸¦ | 12é¢—/ç¯å½¢ | 1 | Â¥5-10 | çŠ¶æ€åé¦ˆ |
| äº¤äº’ | TTP223 è§¦æ‘¸ | ç”µå®¹å¼ | 2 | Â¥1-2 | å¤‡ç”¨å”¤é†’ |
| å¼€å…³ | æ‹¨åŠ¨å¼€å…³ | SS12D00 | 5 | Â¥0.5 | æ€»ç”µæº |
| è¿æ¥ | æœé‚¦çº¿+æ’é’ˆ | 10cmï¼Œå„ç§ | 1æ‰¹ | Â¥10 | å°½é‡çŸ­ |
| æ»¤æ³¢ | ç”µè§£ç”µå®¹ | 100Î¼F 16V | 5 | Â¥1 | å‡å‹æ»¤æ³¢ |

**æ ¸å¿ƒæ¨¡å—æ€»è®¡**ï¼šçº¦ Â¥150-200

### 10.2 æ‰©å±•æ¨¡å—ï¼ˆå¯é€‰ï¼‰

| ä¼˜å…ˆçº§ | åç§° | è§„æ ¼ | æ•°é‡ | å‚è€ƒä»· | åŠŸèƒ½ |
|--------|------|------|------|-------|------|
| â­â­â­â­â­ | VL53L0X | æ¿€å…‰æµ‹è· I2C | 1 | Â¥8-12 | çœ¼ç¥è¿½è¸ª |
| â­â­â­â­ | DHT22 | æ¸©æ¹¿åº¦ä¼ æ„Ÿå™¨ | 1 | Â¥8-12 | ç¯å¢ƒæ„ŸçŸ¥ |
| â­â­â­â­ | BH1750 | å…‰çº¿ä¼ æ„Ÿå™¨ I2C | 1 | Â¥3-5 | å…‰çº¿æ„ŸçŸ¥ |
| â­â­â­ | MPU6050 | å…­è½´å§¿æ€ I2C | 1 | Â¥5-8 | æ‘‡ä¸€æ‘‡å½©è›‹ |
| â­â­â­ | ç‰©ç†æŒ‰é’® | è½»è§¦æŒ‰é”® | 2 | Â¥0.5 | å½©è›‹è§¦å‘ |
| â­â­ | OV2640 | æ‘„åƒå¤´æ¨¡å— | 1 | Â¥15-20 | äººè„¸æ£€æµ‹ |
| â­â­ | MQ-135 | ç©ºæ°”è´¨é‡ | 1 | Â¥8-12 | ç©ºæ°”ç›‘æµ‹ |
| â­ | SDå¡æ¨¡å— | SPI æ¥å£ | 1 | Â¥3-5 | æœ¬åœ°å­˜å‚¨ |

**æ‰©å±•æ¨¡å—æ€»è®¡**ï¼šçº¦ Â¥50-80ï¼ˆå…¨é€‰ï¼‰

### 10.3 é‡‡è´­æ³¨æ„äº‹é¡¹

#### âš ï¸ ESP32-S3 å¼€å‘æ¿ 5V å¼•è„šé—®é¢˜

**é—®é¢˜**ï¼šä¸­å›½ç‰ˆ ESP32-S3 N16R8 å¼€å‘æ¿ 5V å¼•è„šé»˜è®¤åªæœ‰ ~1.8Vã€‚

**è§£å†³**ï¼š
1. ç„Šæ¥çŸ­æ¥æ¿èƒŒé¢çš„ **IN-OUT ç„Šç›˜**
2. æˆ–ç›´æ¥ä» MT3608 è¾“å‡º 5V ç»™åŠŸæ”¾ï¼ˆæ¨èï¼‰

#### å…¶ä»–æ³¨æ„äº‹é¡¹

1. **ESP32-S3 å¿…é¡»æ˜¯ N16R8**ï¼š8MB PSRAM æ˜¯è·‘å”¤é†’è¯æ¨¡å‹çš„ç¡¬æ€§è¦æ±‚
2. **å±å¹•å¿…é¡»å¸¦ PCB åº•æ¿**ï¼šè£¸å±æéš¾ç„Šæ¥
3. **å–‡å­å¿…é¡»å¸¦éŸ³è…”**ï¼šå¦åˆ™éŸ³è´¨å¾ˆå·®
4. **æœé‚¦çº¿å°½é‡çŸ­**ï¼šI2S ä¿¡å·è¶…è¿‡ 10cm å¯èƒ½æœ‰æ‚éŸ³
5. **RGB ç¯å¸¦é€‰ç¯å½¢**ï¼šæ–¹ä¾¿å®‰è£…åœ¨åº•åº§
6. **VL53L0X å®‰è£…ä½ç½®**ï¼šéœ€è¦æ­£å¯¹ç”¨æˆ·æ–¹å‘

---

## 11. å·²çŸ¥é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ

### 11.1 I2S é©±åŠ¨å†²çª

**é—®é¢˜**ï¼šåŒæ—¶ä½¿ç”¨éº¦å…‹é£å’ŒåŠŸæ”¾å¯èƒ½å†²çªã€‚

**è§£å†³**ï¼š
- ä½¿ç”¨ ESP-ADF ç»Ÿä¸€ç®¡ç†
- éº¦å…‹é£ç”¨ I2S_NUM_0ï¼ŒåŠŸæ”¾ç”¨ I2S_NUM_1
- ä¸è¦æ··ç”¨æ–°æ—§ç‰ˆ I2S é©±åŠ¨

### 11.2 å‡å‹æ¨¡å—å™ªéŸ³

**é—®é¢˜**ï¼šMT3608 å¯èƒ½å¯¼è‡´å–‡å­åº•å™ªã€‚

**è§£å†³**ï¼š
- è¾“å‡ºç«¯åŠ  100Î¼F ç”µè§£ç”µå®¹
- å‡å‹æ¨¡å—è¿œç¦»éº¦å…‹é£
- I2S çº¿å°½é‡çŸ­

### 11.3 å”¤é†’è¯è¯¯è§¦å‘

**é—®é¢˜**ï¼šç”µè§†ç­‰ç¯å¢ƒéŸ³è¯¯è§¦å‘ã€‚

**è§£å†³**ï¼š
- é€‰æ‹©ç‹¬ç‰¹çš„å”¤é†’è¯
- è°ƒæ•´æ£€æµ‹é˜ˆå€¼
- å¢åŠ äºŒæ¬¡ç¡®è®¤é€»è¾‘

### 11.4 WiFi é‡è¿å»¶è¿Ÿ

**é—®é¢˜**ï¼šå”¤é†’å WiFi è¿æ¥æ…¢ã€‚

**è§£å†³**ï¼š
- ä½¿ç”¨é™æ€ IP
- ä¿å­˜ WiFi ä¿¡é“ä¿¡æ¯
- è€ƒè™‘ä½¿ç”¨ ESP-NOW æ›¿ä»£éƒ¨åˆ†åœºæ™¯

---

## 12. ç¡¬ä»¶å½¢æ€åˆ›æ„

### 12.1 æ¨¡å—åŒ–è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   çœ¼ç›æ¨¡å—      â”‚  â† å¯æ›´æ¢ä¸åŒé£æ ¼å¤–å£³
â”‚  (å±å¹•+ä¸»æ¿)    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   èº«ä½“æ¨¡å—      â”‚  â† ç”µæ± +æ‰©å±•ä¼ æ„Ÿå™¨
â”‚  (å¯æ‹†å¸)       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   åº•åº§æ¨¡å—      â”‚  â† å¯é€‰ï¼šå……ç”µåº•åº§/ç¯å¸¦åº•åº§
â”‚  (å¤šç§é€‰æ‹©)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 12.2 å¤šå½¢æ€å˜ä½“

| å½¢æ€ | ç‰¹ç‚¹ | åœºæ™¯ |
|------|------|------|
| æ¡Œé¢çƒ | æ ‡å‡†ç‰ˆï¼Œçƒå½¢å¤–å£³ | ä¹¦æ¡Œã€åºŠå¤´ |
| æ˜¾ç¤ºå™¨æŒ‚ä»¶ | è¿·ä½ ç‰ˆï¼Œå¤¹å­å›ºå®š | ç”µè„‘æ— |
| åºŠå¤´ç¯ç‰ˆ | é›†æˆå¤œç¯åŠŸèƒ½ | å§å®¤ |
| è½¦è½½ç‰ˆ | å¸ç›˜å›ºå®šï¼Œè¯­éŸ³å¯¼èˆª | æ±½è½¦ |
| æŒ‚ç»³ç‰ˆ | è¶…è¿·ä½ ï¼Œéšèº«æºå¸¦ | å¤–å‡º |

### 12.3 å¤–å£³æè´¨å»ºè®®

| æè´¨ | ä¼˜ç‚¹ | ç¼ºç‚¹ | æ¨è |
|------|------|------|------|
| 3D æ‰“å° PLA | æˆæœ¬ä½ã€æ˜“å®šåˆ¶ | ç²¾åº¦ä¸€èˆ¬ | åŸå‹é˜¶æ®µ |
| 3D æ‰“å°æ ‘è„‚ | ç²¾åº¦é«˜ã€å…‰æ»‘ | æˆæœ¬è¾ƒé«˜ | å°æ‰¹é‡ |
| äºšå…‹åŠ› | é€æ˜ã€è´¨æ„Ÿå¥½ | éœ€è¦åˆ‡å‰²åŠ å·¥ | ç¯æ•ˆå±•ç¤º |
| ç¡…èƒ¶ | æ‰‹æ„Ÿå¥½ã€å¯çˆ± | éœ€è¦å¼€æ¨¡ | é‡äº§ |

---

## 13. å¼€å‘è·¯çº¿å›¾

### Phase 1: åŸºç¡€åŠŸèƒ½ï¼ˆ2-3 å‘¨ï¼‰

```
â–¡ ç¡¬ä»¶ç»„è£…ä¸æµ‹è¯•
  â”œâ”€â”€ ESP32-S3 ä¸Šç”µæµ‹è¯•
  â”œâ”€â”€ 5V å¼•è„šä¿®å¤
  â”œâ”€â”€ å„æ¨¡å—å•ç‹¬éªŒè¯
  â””â”€â”€ æ•´ä½“è¿çº¿

â–¡ æ ¸å¿ƒè½¯ä»¶
  â”œâ”€â”€ GC9A01 å±å¹•é©±åŠ¨
  â”œâ”€â”€ INMP441 å½•éŸ³æµ‹è¯•
  â”œâ”€â”€ MAX98357A æ’­æ”¾æµ‹è¯•
  â””â”€â”€ WiFi + WebSocket é€šä¿¡

â–¡ åŸºç¡€äº¤äº’
  â”œâ”€â”€ è¯­éŸ³å”¤é†’è¯é›†æˆ
  â”œâ”€â”€ PC æœåŠ¡ç«¯æ­å»º
  â””â”€â”€ ç«¯åˆ°ç«¯è¯­éŸ³å¯¹è¯
```

### Phase 2: æ‹ŸäººåŒ–ä½“éªŒï¼ˆ2-3 å‘¨ï¼‰

```
â–¡ æƒ…ç»ªç³»ç»Ÿ
  â”œâ”€â”€ æƒ…ç»ªçŠ¶æ€å®šä¹‰
  â”œâ”€â”€ çœ¼ç›åŠ¨ç”»å®ç°
  â””â”€â”€ LLM æƒ…ç»ªæ ‡ç­¾æå–

â–¡ è§†è§‰åé¦ˆ
  â”œâ”€â”€ RGB ç¯å¸¦çŠ¶æ€æ•ˆæœ
  â”œâ”€â”€ é—²ç½®åŠ¨ç”»
  â””â”€â”€ è¯´è¯æ³¢å½¢åŠ¨æ•ˆ

â–¡ çœ¼ç¥è¿½è¸ªï¼ˆå¯é€‰ï¼‰
  â”œâ”€â”€ VL53L0X é›†æˆ
  â””â”€â”€ ç³å­”è·Ÿéšé€»è¾‘
```

### Phase 3: æ™ºèƒ½æ‰©å±•ï¼ˆ2-3 å‘¨ï¼‰

```
â–¡ AI èƒ½åŠ›
  â”œâ”€â”€ è®°å¿†ç³»ç»Ÿ
  â”œâ”€â”€ æœ¬åœ°æŒ‡ä»¤è¯†åˆ«
  â””â”€â”€ ä¸»åŠ¨å…³æ€€å®šæ—¶ä»»åŠ¡

â–¡ ç¯å¢ƒæ„ŸçŸ¥ï¼ˆå¯é€‰ï¼‰
  â”œâ”€â”€ æ¸©æ¹¿åº¦/å…‰çº¿ä¼ æ„Ÿå™¨
  â””â”€â”€ ç¯å¢ƒæé†’é€»è¾‘

â–¡ æ™ºèƒ½å®¶å±…ï¼ˆå¯é€‰ï¼‰
  â”œâ”€â”€ MQTT åè®®å¯¹æ¥
  â””â”€â”€ è®¾å¤‡æ§åˆ¶æŒ‡ä»¤
```

### Phase 4: è¶£å‘³ç©æ³•ï¼ˆ1-2 å‘¨ï¼‰

```
â–¡ å°æ¸¸æˆ
  â”œâ”€â”€ çŒœæ•°å­—
  â””â”€â”€ æˆè¯­æ¥é¾™

â–¡ æ¡Œé¢å® ç‰©
  â”œâ”€â”€ è‡ªä¸»è¡Œä¸ºçŠ¶æ€æœº
  â””â”€â”€ äº’åŠ¨åé¦ˆ

â–¡ å½©è›‹
  â”œâ”€â”€ æ€§æ ¼åˆ‡æ¢
  â”œâ”€â”€ æ ‘æ´æ¨¡å¼
  â””â”€â”€ æ‘‡ä¸€æ‘‡å†·çŸ¥è¯†
```

### Phase 5: ä¼˜åŒ–æ‰“ç£¨ï¼ˆæŒç»­ï¼‰

```
â–¡ åŠŸè€—ä¼˜åŒ–
â–¡ å“åº”é€Ÿåº¦ä¼˜åŒ–
â–¡ å¤–å£³è®¾è®¡ä¸åˆ¶ä½œ
â–¡ OTA å‡çº§æ”¯æŒ
â–¡ æ–‡æ¡£ä¸å¼€æº
```

---

## é™„å½• Aï¼šå¸‚åœºæ–¹æ¡ˆå¯¹æ¯”å‚è€ƒ

### A.1 å•†ä¸šäº§å“æŠ€æœ¯è·¯çº¿

| äº§å“ | ä¸»æ§ | å”¤é†’æ–¹æ¡ˆ | ä¾›ç”µ | ç‰¹ç‚¹ |
|------|------|---------|------|------|
| å°çˆ±åŒå­¦ mini | å…¨å¿— R16 | æœ¬åœ°æ£€æµ‹ | æ’ç”µ | ç±³å®¶ç”Ÿæ€ |
| å¤©çŒ«ç²¾çµ | è”å‘ç§‘ MT8516 | æœ¬åœ°æ£€æµ‹ | æ’ç”µ | é˜¿é‡Œç”Ÿæ€ |
| Amazon Echo | ä¸“ç”¨èŠ¯ç‰‡ | ç¡¬ä»¶å”¤é†’ | æ’ç”µ | Alexa ç”Ÿæ€ |
| **Wallace** | ESP32-S3 | WakeNet | ç”µæ±  | å¼€æºã€DIY |

### A.2 ä¸ºä»€ä¹ˆé€‰æ‹© ESP32-S3

| ç»´åº¦ | ESP32-S3 | ä¸“ç”¨è¯­éŸ³èŠ¯ç‰‡ | æ ‘è“æ´¾ |
|------|---------|------------|-------|
| æˆæœ¬ | Â¥35-50 | Â¥50-100+ | Â¥200+ |
| åŠŸè€— | 25mA ç›‘å¬ | <1mA | 500mA+ |
| å¼€å‘éš¾åº¦ | ä¸­ç­‰ | é«˜ | ä½ |
| çµæ´»æ€§ | é«˜ | ä½ | é«˜ |
| ç”µæ± ç»­èˆª | 3-5 å¤© | æ•°å‘¨ | å‡ å°æ—¶ |
| é€‚åˆåœºæ™¯ | DIY/æ¡Œé¢ | ä¸“ä¸šäº§å“ | æœåŠ¡å™¨ |

**ç»“è®º**ï¼šESP32-S3 åœ¨æˆæœ¬ã€åŠŸè€—ã€çµæ´»æ€§ä¹‹é—´å–å¾—äº†æœ€ä½³å¹³è¡¡ï¼Œé€‚åˆ Wallace çš„å®šä½ã€‚

---

## é™„å½• Bï¼šå¼€å‘è°ƒè¯•å»ºè®®

### B.1 æ¨èå¼€å‘é¡ºåº

1. **å…ˆè·‘é€šæœ€å°ç³»ç»Ÿ**ï¼šå±å¹• + éº¦å…‹é£ + å–‡å­
2. **å†åŠ å…¥å”¤é†’è¯**ï¼šç¡®ä¿åŸºç¡€äº¤äº’æ­£å¸¸
3. **ç„¶åé€æ­¥æ‰©å±•**ï¼šæƒ…ç»ªã€ç¯å¸¦ã€ä¼ æ„Ÿå™¨
4. **æœ€åä¼˜åŒ–æ‰“ç£¨**ï¼šåŠŸè€—ã€å¤–å£³ã€ç»†èŠ‚

### B.2 è°ƒè¯•å·¥å…·

| å·¥å…· | ç”¨é€” |
|------|------|
| USB ä¸²å£ | æ—¥å¿—è¾“å‡º |
| ä¸‡ç”¨è¡¨ | ç”µå‹/ç”µæµæµ‹é‡ |
| é€»è¾‘åˆ†æä»ª | I2S/SPI ä¿¡å·åˆ†æ |
| Audacity | éŸ³é¢‘å½•åˆ¶/åˆ†æ |

### B.3 å¸¸è§é—®é¢˜æ’æŸ¥

```
é—®é¢˜ï¼šéº¦å…‹é£æ²¡å£°éŸ³
â†’ æ£€æŸ¥ L/R å¼•è„šæ˜¯å¦æ¥åœ°
â†’ æ£€æŸ¥ I2S å¼•è„šé…ç½®
â†’ ç”¨ç¤ºæ³¢å™¨/é€»è¾‘åˆ†æä»ªçœ‹ BCLK/WS ä¿¡å·

é—®é¢˜ï¼šå–‡å­æ²¡å£°éŸ³
â†’ æ£€æŸ¥ 5V ä¾›ç”µæ˜¯å¦æ­£å¸¸
â†’ æ£€æŸ¥ I2S_NUM æ˜¯å¦æ­£ç¡®ï¼ˆåº”è¯¥ç”¨ I2S_NUM_1ï¼‰
â†’ æ£€æŸ¥ SD å¼•è„šæ˜¯å¦æ‚¬ç©ºæˆ–æ¥é«˜

é—®é¢˜ï¼šå±å¹•ä¸äº®
â†’ æ£€æŸ¥ BLK èƒŒå…‰å¼•è„š
â†’ æ£€æŸ¥ SPI å¼•è„šé…ç½®
â†’ ç¡®è®¤ CS ç‰‡é€‰æ­£ç¡®
```

---

## ç‰ˆæœ¬å†å²

| ç‰ˆæœ¬ | æ—¥æœŸ | æ›´æ–°å†…å®¹ |
|------|------|---------|
| v1 | - | åˆå§‹æ–¹æ¡ˆï¼ˆSTM32 + ESP8266ï¼‰ |
| v2 | - | å‡çº§ä¸º ESP32-S3 å•èŠ¯ç‰‡æ–¹æ¡ˆ |
| v3 | - | æ–°å¢è¯­éŸ³å”¤é†’ã€ç¡¬ä»¶å®¡æ ¸ã€åŠŸè€—ä¼˜åŒ– |
| v4 | 2026-02 | æ–°å¢æƒ…ç»ªç³»ç»Ÿã€çœ¼ç¥è¿½è¸ªã€ç¯å¢ƒæ„ŸçŸ¥ã€æ™ºèƒ½å®¶å±…ã€è¶£å‘³ç©æ³• |

---

> **Wallace** - ä¸åªæ˜¯ä¸€ä¸ªè¯­éŸ³åŠ©æ‰‹ï¼Œè€Œæ˜¯ä¸€ä¸ªæœ‰æƒ…æ„Ÿã€æœ‰ä¸ªæ€§ã€ä¼šé™ªä¼´ä½ çš„æ¡Œé¢ AI ä¼™ä¼´ã€‚
> 
> ğŸ­ å®ƒä¼šå¼€å¿ƒã€ä¼šéš¾è¿‡ã€ä¼šå¥½å¥‡  
> ğŸ‘€ å®ƒä¼šçœ‹ç€ä½ ã€è·Ÿéšä½ çš„æ–¹å‘  
> ğŸ’¬ å®ƒä¼šè®°ä½ä½ ã€ä¸»åŠ¨å…³å¿ƒä½   
> ğŸ® å®ƒä¼šé™ªä½ ç©ã€ç»™ä½ æƒŠå–œ  
> 
> **è®© AI çœŸæ­£"æ´»"èµ·æ¥ã€‚**
